<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vroom Adventures</title>
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#f45436">
    
    <!-- Core Styles -->
    <link rel="stylesheet" href="./styles/main.css">
    <link rel="stylesheet" href="./styles/components.css">
</head>
<body>
    <div class="app-container">
        <!-- Navigation Header -->
        <header class="app-header">
            <nav class="main-nav">
                <h1 class="app-title">
                    <span class="car-icon">üöó</span>
                    <span data-i18n="app.title">Vroom Adventures</span>
                </h1>
                <div class="nav-actions">
                    <language-selector></language-selector>
                    <button class="btn btn-ghost settings-btn" data-i18n="nav.settings">Settings</button>
                </div>
            </nav>
        </header>

        <main class="app-main">
            <!-- Welcome Section -->
            <section class="welcome-section screen active" data-screen="welcome">
                <div class="welcome-card">
                    <header class="welcome-header">
                        <h2 data-i18n="welcome.title">Welcome to Vroom Adventures!</h2>
                        <p data-i18n="welcome.subtitle">Scan your wooden car to start your journey</p>
                    </header>
                    
                    <div class="action-list">
                        <button class="btn btn-primary scan-nfc-btn">
                            <span class="btn-icon">üì±</span>
                            <span data-i18n="welcome.scan">Scan NFC Car</span>
                        </button>
                        
                        <button class="btn btn-secondary manual-select-btn">
                            <span class="btn-icon">üöó</span>
                            <span data-i18n="welcome.manual">Choose Car Manually</span>
                        </button>
                        
                        <button class="btn btn-success create-driver-btn">
                            <span class="btn-icon">üë§</span>
                            <span data-i18n="welcome.driver">Create Driver Profile</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Driver Profile Section -->
            <section class="driver-section screen" data-screen="driver">
                <article class="driver-card">
                    <header class="card-header">
                        <h2 data-i18n="driver.title">Driver Profile</h2>
                    </header>
                    
                    <form class="driver-form">
                        <fieldset class="form-fieldset">
                            <legend class="sr-only" data-i18n="driver.legend">Driver Information</legend>
                            
                            <div class="form-group">
                                <label for="driver-name" data-i18n="driver.name">Driver Name</label>
                                <input type="text" id="driver-name" name="driverName" required 
                                       class="form-input" autocomplete="name">
                            </div>
                            
                            <div class="form-group">
                                <label for="home-location" data-i18n="driver.home">Home Location</label>
                                <div class="input-group">
                                    <input type="text" id="home-location" name="homeLocation" required 
                                           class="form-input" placeholder="City, Country" autocomplete="address-level2">
                                    <button type="button" class="btn btn-icon use-location-btn" 
                                            title="Use current location">üìç</button>
                                </div>
                            </div>
                        </fieldset>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-success" data-i18n="driver.save">Save Profile</button>
                        </div>
                    </form>
                </article>
            </section>

            <!-- Car Selection Section -->
            <section class="car-select-section screen" data-screen="car-select">
                <article class="car-select-card">
                    <header class="card-header">
                        <h2 data-i18n="car.select">Select Your Car</h2>
                    </header>
                    <div class="car-grid" role="grid">
                        <!-- Car options will be populated here -->
                    </div>
                </article>
            </section>

            <!-- Main Dashboard -->
            <section class="dashboard-section screen" data-screen="dashboard">
                <!-- Current Car Display -->
                <article class="current-car-card">
                    <header class="card-header">
                        <h2 data-i18n="dashboard.current_car">Current Car</h2>
                        <button class="btn btn-secondary switch-car-btn" data-i18n="dashboard.switch">Switch Car</button>
                    </header>
                    
                    <div class="car-info">
                        <h3 class="car-name">Loading...</h3>
                        <div class="car-viewer-container">
                            <car-viewer></car-viewer>
                        </div>
                    </div>

                    <!-- Stats Grid -->
                    <div class="stats-grid" role="grid">
                        <div class="stat-card distance-stat" role="gridcell">
                            <div class="stat-value" id="total-distance">0 km</div>
                            <div class="stat-label" data-i18n="dashboard.total_distance">Total Distance</div>
                        </div>
                        <div class="stat-card photos-stat" role="gridcell">
                            <div class="stat-value" id="photo-count">0</div>
                            <div class="stat-label" data-i18n="dashboard.photos">Photos Taken</div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <button class="btn btn-primary take-photo-btn">
                            <span class="btn-icon">üì∏</span>
                            <span data-i18n="dashboard.take_photo">Take Photo</span>
                        </button>
                        <button class="btn btn-secondary view-gallery-btn">
                            <span class="btn-icon">üñºÔ∏è</span>
                            <span data-i18n="dashboard.gallery">Gallery</span>
                        </button>
                    </div>
                </article>

                <!-- Milestones & Achievements -->
                <article class="achievements-card">
                    <header class="card-header">
                        <h2 data-i18n="dashboard.achievements">Achievements</h2>
                    </header>
                    <div class="milestones-container">
                        <!-- Milestone components will be populated here -->
                    </div>
                </article>

                <!-- Journey Timeline -->
                <article class="timeline-card">
                    <header class="card-header">
                        <h2 data-i18n="dashboard.journey">Journey Timeline</h2>
                    </header>
                    <photo-timeline></photo-timeline>
                </article>
            </section>

            <!-- Photo Capture Section -->
            <section class="photo-section screen" data-screen="photo">
                <article class="photo-card">
                    <header class="card-header">
                        <h2 data-i18n="photo.title">Capture Adventure</h2>
                    </header>
                    
                    <div class="camera-container">
                        <video class="camera-preview" autoplay playsinline muted></video>
                        <canvas class="photo-canvas" style="display: none;"></canvas>
                    </div>
                    
                    <div class="camera-actions">
                        <button class="btn btn-primary capture-btn">
                            <span class="btn-icon">üì∏</span>
                            <span data-i18n="photo.capture">Capture</span>
                        </button>
                        <button class="btn btn-secondary cancel-photo-btn">
                            <span data-i18n="photo.cancel">Cancel</span>
                        </button>
                    </div>
                </article>
            </section>

            <!-- Settings Section -->
            <section class="settings-section screen" data-screen="settings">
                <article class="settings-card">
                    <header class="card-header">
                        <h2 data-i18n="settings.title">Settings</h2>
                    </header>
                    
                    <form class="settings-form">
                        <fieldset class="form-fieldset">
                            <legend data-i18n="settings.preferences">Preferences</legend>
                            
                            <div class="form-group">
                                <label for="language-select" data-i18n="settings.language">Language</label>
                                <select id="language-select" class="form-select">
                                    <option value="en">English</option>
                                    <option value="fr">Fran√ßais</option>
                                    <option value="es">Espa√±ol</option>
                                    <option value="de">Deutsch</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="new-home-location" data-i18n="settings.home">Update Home Location</label>
                                <div class="input-group">
                                    <input type="text" id="new-home-location" class="form-input">
                                    <button type="button" class="btn btn-secondary update-home-btn" 
                                            data-i18n="settings.update">Update</button>
                                </div>
                            </div>
                        </fieldset>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-success export-data-btn">
                                <span class="btn-icon">üíæ</span>
                                <span data-i18n="settings.export">Export Data</span>
                            </button>
                            <button type="button" class="btn btn-secondary close-settings-btn" 
                                    data-i18n="settings.close">Close</button>
                        </div>
                    </form>
                </article>
            </section>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" role="dialog" aria-labelledby="loading-text" aria-hidden="true">
        <div class="loading-content">
            <div class="loading-spinner" role="status" aria-label="Loading"></div>
            <p id="loading-text" data-i18n="loading">Loading...</p>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal-overlay nfc-modal" role="dialog" aria-labelledby="nfc-title" aria-hidden="true">
        <div class="modal-content">
            <header class="modal-header">
                <h3 id="nfc-title" data-i18n="nfc.not_supported">NFC Not Supported</h3>
            </header>
            <div class="modal-body">
                <p data-i18n="nfc.message">Your device doesn't support NFC or it's disabled. You can still use the app by selecting your car manually.</p>
            </div>
            <footer class="modal-footer">
                <button class="btn btn-primary close-nfc-modal" data-i18n="nfc.ok">OK</button>
            </footer>
        </div>
    </div>

    <!-- EXTERNAL LIBRARIES FIRST -->
    <script src="https://unpkg.com/dexie@3.2.4/dist/dexie.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/STLLoader.js"></script>

    <!-- SERVICES (Non-module scripts) -->
    <script src="./services/database.js"></script>
    <script src="./services/geolocation.js"></script>
    <script src="./services/translation.js"></script>
    <script src="./services/nfc.js"></script>
    <script src="./services/camera.js"></script>
    <script src="./services/milestone.js"></script>
    <script src="./services/utils.js"></script>

    <!-- COMPONENTS -->
    <script src="./components/car-viewer.js"></script>
    <script src="./components/photo-timeline.js"></script>
    <script src="./components/milestone-card.js"></script>
    <script src="./components/language-selector.js"></script>

    <!-- MAIN APP -->
    <script src="./app.js"></script>
</body>
</html>